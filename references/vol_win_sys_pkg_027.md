
## 火山"视窗项目"系统类库模块: MFC界面基本类

### 包: 火山.MFC界面.数据库

---

#### 火山.MFC界面.数据库.外部数据库

* **类型:** `类`
* **名称:** `外部数据库`
* **基础类:** `参考对象类`
* **描述:** 提供以ODBC的方式对数据库进行访问的支持
* **相关例程:** [vol-odbc外部数据库-odbc-main](#vol-odbc外部数据库-odbc-main)

##### 火山.MFC界面.数据库.外部数据库.打开

* **类型:** `方法`
* **名称:** `打开`
* **返回值数据类型:** `逻辑型`
* **参数:**
	* `ODBC数据源连接文本` (`文本型`, 默认值: `""`): 提供指向ODBC数据源的连接文本,如果为空文本,则激活ODBC数据源选择对话框.
	* `是否只读` (`逻辑型`, 默认值: `假`): 指定是否以只读方式打开
	* `不显示ODBC连接对话框` (`逻辑型`, 默认值: `假`): 指定当数据源连接失败的时候,是否自动显示ODBC的数据源连接对话框.
* **描述:** 打开指定的ODBC数据源以供以后操作
* **返回值描述:** 成功返回真,失败返回假.

##### 火山.MFC界面.数据库.外部数据库.打开MDB数据库

* **类型:** `方法`
* **名称:** `打开MDB数据库`
* **返回值数据类型:** `逻辑型`
* **参数:**
	* `MDB数据库文件名` (`文本型`): 提供即将打开数据库的文件名
	* `用户名` (`文本型`, 默认值: `""`): 提供打开数据库所需要的用户名,为空文本表示不需要.
	* `密码` (`文本型`, 默认值: `""`): 提供打开数据库所需要的密码,为空文本表示不需要.
	* `是否只读` (`逻辑型`, 默认值: `假`): 指定是否以只读方式打开
	* `不显示ODBC连接对话框` (`逻辑型`, 默认值: `真`): 指定当数据源连接失败的时候,是否自动显示ODBC的数据源连接对话框.
* **描述:** 本方法是针对 ACCESS MDB 数据库的特定打开方法,通过自建 ODBC 连接文本来打开 MDB 数据库. 调用本命令后无需再调用"打开"命令.
* **返回值描述:** 成功返回真,失败返回假.
* **相关例程:** [vol-odbc外部数据库-odbc-main](#vol-odbc外部数据库-odbc-main)

##### 火山.MFC界面.数据库.外部数据库.打开SQL数据库

* **类型:** `方法`
* **名称:** `打开SQL数据库`
* **返回值数据类型:** `逻辑型`
* **参数:**
	* `服务器名称` (`文本型`): 提供 SQL SERVER 服务器的名称或其客户端别名
	* `用户名` (`文本型`, 默认值: `""`): 提供登录服务器所需要的用户名,为空文本表示不需要.
	* `密码` (`文本型`, 默认值: `""`): 提供登录服务器所需要的密码,为空文本表示不需要.
	* `数据库名称` (`文本型`, 默认值: `""`): 提供即将打开数据库的名称,为空文本表示使用该用户的默认数据库.
	* `是否只读` (`逻辑型`, 默认值: `假`): 指定是否以只读方式打开
	* `不显示ODBC连接对话框` (`逻辑型`, 默认值: `真`): 指定当数据源连接失败的时候,是否自动显示ODBC的数据源连接对话框.
* **描述:** 本方法是针对 SQL SERVER 数据库的特定打开方法,通过自建 ODBC 连接文本来打开 SQL SERVER 数据库. 调用本命令后无需再调用"打开"命令.
* **返回值描述:** 成功返回真,失败返回假.

##### 火山.MFC界面.数据库.外部数据库.关闭

* **类型:** `方法`
* **名称:** `关闭`
* **描述:** 关闭当前被打开的数据库,所有被打开的记录集会被全部自动关闭.

##### 火山.MFC界面.数据库.外部数据库.取所有表名

* **类型:** `方法`
* **名称:** `取所有表名`
* **返回值数据类型:** `整数`
* **参数:**
	* `结果表名数组` (`文本数组类`): 提供用作存放所获取到的结果表名列表的数组
* **描述:** 获取数据库中所有数据表的名称
* **返回值描述:** 返回所获取到的表名数目(即存放到"结果表名数组"参数数组中的成员数目).
* **相关例程:** [vol-odbc外部数据库-odbc-main](#vol-odbc外部数据库-odbc-main)

##### 火山.MFC界面.数据库.外部数据库.取连接文本

* **类型:** `方法`
* **名称:** `取连接文本`
* **返回值数据类型:** `文本型`
* **描述:** 成功返回当前被打开数据库的ODBC数据源连接文本,失败返回空文本.

##### 火山.MFC界面.数据库.外部数据库.启动事务

* **类型:** `方法`
* **名称:** `启动事务`
* **返回值数据类型:** `逻辑型`
* **描述:** 启动当前被打开数据库的事务
* **返回值描述:** 成功返回真,失败返回假.

##### 火山.MFC界面.数据库.外部数据库.回滚事务

* **类型:** `方法`
* **名称:** `回滚事务`
* **描述:** 回滚当前被打开数据库的事务,所有在上一次事务提交前对数据库所作的修改均被取消.

##### 火山.MFC界面.数据库.外部数据库.提交事务

* **类型:** `方法`
* **名称:** `提交事务`
* **描述:** 提交当前被打开数据库的事务

##### 火山.MFC界面.数据库.外部数据库.查询

* **类型:** `方法`
* **名称:** `查询`
* **返回值数据类型:** `变整数`
* **参数:**
	* `查询类SQL语句` (`文本型`): 提供用作查询的SELECT语句
	* `是否只读` (`逻辑型`, 默认值: `真`): 指定是否不能对查询结果记录集进行修改(如提供为假,需要需要数据库本身支持)
	* `最大文本长度` (`整数`, 默认值: `1024`): 指定最大读/写文本数据的长度,超出此长度的文本数据将被裁剪.
	* `最大字节集尺寸` (`整数`, 默认值: `0x10000`): 指定最大读/写字节集数据的尺寸,超出此尺寸的字节集数据将被裁剪,为-1表示不限制.
* **描述:** 对当前被打开数据库进行数据查询,成功返回结果记录集句柄,失败返回0. 注意当不再使用此记录集时,必须使用"关闭记录集"命令将其关闭.
* **相关例程:** [vol-odbc外部数据库-odbc-main](#vol-odbc外部数据库-odbc-main)

##### 火山.MFC界面.数据库.外部数据库.重新查询

* **类型:** `方法`
* **名称:** `重新查询`
* **返回值数据类型:** `逻辑型`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
* **描述:** 对指定的记录集进行重新查询,并将其当前记录指针重定位到首记录.
* **返回值描述:** 成功返回真,失败返回假.

##### 火山.MFC界面.数据库.外部数据库.关闭记录集

* **类型:** `方法`
* **名称:** `关闭记录集`
* **参数:**
	* `记录集句柄` (`变整数`, 默认值: `0`): 指定欲关闭记录集的句柄,记录集句柄由"查询"命令返回. 如果参数值为0,则关闭所有记录集.
* **描述:** 关闭指定的记录集
* **相关例程:** [vol-odbc外部数据库-odbc-main](#vol-odbc外部数据库-odbc-main)

##### 火山.MFC界面.数据库.外部数据库.首记录前

* **类型:** `方法`
* **名称:** `首记录前`
* **返回值数据类型:** `逻辑型`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
* **描述:** 如果指定记录集的当前记录指针已在首记录的前面,返回真,否则返回假.

##### 火山.MFC界面.数据库.外部数据库.尾记录后

* **类型:** `方法`
* **名称:** `尾记录后`
* **返回值数据类型:** `逻辑型`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
* **描述:** 如果指定记录集的当前记录指针已在尾记录的后面,返回真,否则返回假.

##### 火山.MFC界面.数据库.外部数据库.到首记录

* **类型:** `方法`
* **名称:** `到首记录`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
* **描述:** 将指定记录集的当前记录指针移动到第一条记录上

##### 火山.MFC界面.数据库.外部数据库.到尾记录

* **类型:** `方法`
* **名称:** `到尾记录`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
* **描述:** 将指定记录集的当前记录指针移动到最后一条记录上

##### 火山.MFC界面.数据库.外部数据库.到前一记录

* **类型:** `方法`
* **名称:** `到前一记录`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
* **描述:** 将指定记录集的当前记录指针向前移动一条记录

##### 火山.MFC界面.数据库.外部数据库.到后一记录

* **类型:** `方法`
* **名称:** `到后一记录`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
* **描述:** 将指定记录集的当前记录指针向后移动一条记录
* **相关例程:** [vol-odbc外部数据库-odbc-main](#vol-odbc外部数据库-odbc-main)

##### 火山.MFC界面.数据库.外部数据库.到指定记录

* **类型:** `方法`
* **名称:** `到指定记录`
* **返回值数据类型:** `逻辑型`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
	* `记录索引位置` (`整数`): 提供所欲移动到的阿记录索引位置,从0开始.
* **描述:** 将指定记录集的当前记录指针移动到指定位置(注意可能需要数据库系统支持)
* **返回值描述:** 成功返回真,失败返回假.

##### 火山.MFC界面.数据库.外部数据库.读

* **类型:** `方法`
* **名称:** `读`
* **返回值数据类型:** `COM变体型`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
	* `字段索引` (`整数`, 默认值: `-1`): 提供所欲读取字段的索引位置,从0开始. 为-1表示基于字段名称进行定位.
	* `字段名称` (`文本型`, 默认值: `""`): 提供所欲读取字段的名称. 为空文本表示基于字段索引进行定位.
* **描述:** 返回指定记录集的当前记录处指定字段的数据值,如果读入失败将返回为空("COM变体型.是否为空"方法返回真)的COM变体型. 火山数据类型和字段SQL类型对照表如下: 火山数据类型   字段SQL类型 ------------------------------------------------- 逻辑型         BIT 字节           TINYINT 短整数         SMALLINT 整数           INTEGER 单精度小数     REAL、FLOAT 小数           DOUBLE、DATE、TIME、TIMESTAMP 文本型         NUMERIC、DECIMAL、BIGINT、CHAR、VARCHAR、LONGVARCHAR 字节集类:      BINARY, VARBINARY, LONGVARBINARY. 另外,由于ODBC的支持特性,如果不移动记录指针,只能对当前记录上各字段的内容读入一次.因此,如果需要持续使用所读出的数据,请使用变量将其保存. 注: 写入字段数据请用 "UPDATE" SQL语句实现.

##### 火山.MFC界面.数据库.外部数据库.执行

* **类型:** `方法`
* **名称:** `执行`
* **返回值数据类型:** `逻辑型`
* **参数:**
	* `非查询类SQL语句` (`文本型`): 提供非查询类SQL语句(无结果集返回),如修改/删除/添加等等.
* **描述:** 执行指定的非查询类SQL语句,SQL语句中的列名(尤其是中文列名)可用中括号括住.
* **返回值描述:** 成功返回真,失败返回假.
* **相关例程:** [vol-odbc外部数据库-odbc-main](#vol-odbc外部数据库-odbc-main)

##### 火山.MFC界面.数据库.外部数据库.带参数执行

* **类型:** `方法`
* **名称:** `带参数执行`
* **返回值数据类型:** `逻辑型`
* **参数:**
	* `非查询类SQL语句` (`文本型`): 提供非查询类SQL语句(无结果集返回),如修改/删除/添加等等.
	* `文本或字节集` (`通用型`, `可扩展`): 本参数仅用作为SQL语句中的备注或字节集型SQL参数(用问号标识其位置)提供相应数据,必须为文本或者字节集类(与SQL参数类型必须对应).
* **描述:** 执行指定的非查询类SQL语句,SQL语句中的列名(尤其是中文列名)可用中括号括住. 如果SQL语句中涉及到备注或者字节集型字段,请在相应位置加上问号,然后再加上对应的文本型或字节集型数据参数,参数数目和类型必须与问号的数目一致. 例如: 修改数据表student中编号为100的学生像片的语句为: 外部数据库.带参数执行 ("update student set picture = ? where no = 100", 像片数据字节集).
* **返回值描述:** 成功返回真,失败返回假.

##### 火山.MFC界面.数据库.外部数据库.取记录数

* **类型:** `方法`
* **名称:** `取记录数`
* **返回值数据类型:** `整数`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
* **描述:** 成功返回所指定记录集的记录数目(注意可能需要数据库系统支持),失败/未知返回-1.
* **相关例程:** [vol-odbc外部数据库-odbc-main](#vol-odbc外部数据库-odbc-main)

##### 火山.MFC界面.数据库.外部数据库.取字段数

* **类型:** `方法`
* **名称:** `取字段数`
* **返回值数据类型:** `整数`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
* **描述:** 成功返回所指定记录集的字段数目,失败或者为空返回0.

##### 火山.MFC界面.数据库.外部数据库.读字段文本

* **类型:** `方法`
* **名称:** `读字段文本`
* **返回值数据类型:** `文本型`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
	* `记录索引位置` (`整数`, 默认值: `-1`): 提供所欲访问记录的索引位置,从0开始. 提供-1表示使用当前记录位置. 注意提供非-1值可能需要数据库系统支持.
	* `字段索引位置` (`整数`): 提供所欲访问字段的索引位置,从0开始.
* **描述:** 返回所指定记录集指定位置处记录的指定字段内容(以文本方式返回). 注意不能读入字节集类型的字段,其需要使用"读字节集字段"方法读入.
* **返回值描述:** 成功返回字段内容,失败返回空文本.
* **相关例程:** [vol-odbc外部数据库-odbc-main](#vol-odbc外部数据库-odbc-main)

##### 火山.MFC界面.数据库.外部数据库.写字段文本

* **类型:** `方法`
* **名称:** `写字段文本`
* **返回值数据类型:** `逻辑型`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回,并且"是否只读"参数必须提供为假.
	* `记录索引位置` (`整数`, 默认值: `-1`): 提供所欲访问记录的索引位置,从0开始. 提供-1表示使用当前记录位置. 注意提供非-1值可能需要数据库系统支持.
	* `字段索引位置` (`整数`): 提供所欲访问字段的索引位置,从0开始.
	* `所欲写入内容` (`文本型`): 提供所欲写入的字段内容. 注意: 1. 如果是日期字段,要转换为数据库系统所认可的对应文本格式; 2. 所写入内容长度必须小于等于调用"查询"方法时所提供的"最大文本长度"参数值.
* **描述:** 以文本方式写入所指定记录集指定位置处记录的指定字段内容. 注意不能写入字节集类型的字段,其需要使用"写字节集字段"方法写入.
* **返回值描述:** 成功返回真,失败返回假.

##### 火山.MFC界面.数据库.外部数据库.读字节集字段

* **类型:** `方法`
* **名称:** `读字节集字段`
* **返回值数据类型:** `逻辑型`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
	* `记录索引位置` (`整数`, 默认值: `-1`): 提供所欲访问记录的索引位置,从0开始. 提供-1表示使用当前记录位置. 注意提供非-1值可能需要数据库系统支持.
	* `字段索引位置` (`整数`): 提供所欲访问字段的索引位置,从0开始.
	* `结果字节集` (`字节集类`): 所读取到的字节集内容将写入到此参数中
* **描述:** 读取所指定记录集指定位置处记录的指定字节集类型字段内容
* **返回值描述:** 成功返回真,失败返回假.

##### 火山.MFC界面.数据库.外部数据库.写字节集字段

* **类型:** `方法`
* **名称:** `写字节集字段`
* **返回值数据类型:** `逻辑型`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回,并且"是否只读"参数必须提供为假.
	* `记录索引位置` (`整数`, 默认值: `-1`): 提供所欲访问记录的索引位置,从0开始. 提供-1表示使用当前记录位置. 注意提供非-1值可能需要数据库系统支持.
	* `字段索引位置` (`整数`): 提供所欲访问字段的索引位置,从0开始.
	* `所欲写入内容` (`字节集类`): 提供所欲写入的字段内容. 注意: 所写入内容长度必须小于等于调用"查询"方法时所提供的"最大字节集尺寸"参数值.
* **描述:** 写入所指定记录集指定位置处记录的指定字节集类型字段内容
* **返回值描述:** 成功返回真,失败返回假.

##### 火山.MFC界面.数据库.外部数据库.取字段类型

* **类型:** `方法`
* **名称:** `取字段类型`
* **返回值数据类型:** `整数`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
	* `字段索引位置` (`整数`): 提供所欲访问字段的索引位置,从0开始.
* **描述:** 返回所指定记录集指定位置字段的SQL类型. 下面列出常用的SQL类型表(更详细资料请自行查阅相关文档): SQL类型            意义            值 ------------------------------------- SQL_BIT            逻辑型          -7 SQL_TINYINT        字节            -6 SQL_SMALLINT       短整数           5 SQL_INTEGER        整数             4 SQL_REAL           单精度浮点数     7 SQL_FLOAT          浮点数           6 SQL_DOUBLE         双精度浮点数     8 SQL_DATE           日期             9 SQL_TIME           时间            10 SQL_TIMESTAMP      时间戳          11 SQL_NUMERIC        数值             2 SQL_DECIMAL        小数             3 SQL_BIGINT         长整数          -5 SQL_CHAR           字符串           1 SQL_VARCHAR        变长字符串      12 SQL_LONGVARCHAR    超长字符串      -1 SQL_WCHAR          宽字符串        -8 SQL_WVARCHAR       变长宽字符串    -9 SQL_WLONGVARCHAR   超长宽字符串   -10 SQL_BINARY         二进制数据      -2 SQL_VARBINARY      变长二进制数据  -3 SQL_LONGVARBINARY  超长二进制数据  -4

##### 火山.MFC界面.数据库.外部数据库.添加空记录

* **类型:** `方法`
* **名称:** `添加空记录`
* **返回值数据类型:** `逻辑型`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回,并且"是否只读"参数必须提供为假.
* **描述:** 在所指定记录集尾部加入一条空白记录(注意可能需要数据库系统支持)
* **返回值描述:** 成功返回真,失败返回假.

##### 火山.MFC界面.数据库.外部数据库.删除记录

* **类型:** `方法`
* **名称:** `删除记录`
* **返回值数据类型:** `逻辑型`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回,并且"是否只读"参数必须提供为假.
	* `起始记录索引` (`整数`): 指定所欲删除记录的首索引位置,从0开始. 提供-1表示使用当前记录位置. 注意提供非-1值可能需要数据库系统支持.
	* `删除记录数` (`整数`): 指定所欲删除记录的数目
* **描述:** 删除所指定记录集中的所指定范围记录
* **返回值描述:** 成功返回真,失败返回假.

##### 火山.MFC界面.数据库.外部数据库.取字段名

* **类型:** `方法`
* **名称:** `取字段名`
* **返回值数据类型:** `文本型`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
	* `字段索引位置` (`整数`): 提供所欲访问字段的索引位置,从0开始.
* **描述:** 返回所指定位置处字段的名称

##### 火山.MFC界面.数据库.外部数据库.取字段宽度

* **类型:** `方法`
* **名称:** `取字段宽度`
* **返回值数据类型:** `整数`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
	* `字段索引位置` (`整数`): 提供所欲访问字段的索引位置,从0开始.
* **描述:** 返回所指定位置处字段的最大可能宽度,失败返回0.

##### 火山.MFC界面.数据库.外部数据库.取字段索引

* **类型:** `方法`
* **名称:** `取字段索引`
* **返回值数据类型:** `整数`
* **参数:**
	* `记录集句柄` (`变整数`): 指定欲操作记录集的句柄.记录集句柄由"查询"命令返回.
	* `字段名称` (`文本型`): 提供所欲查找字段的名称
* **描述:** 返回指定名称字段在记录集中的索引位置,不存在返回-1.
