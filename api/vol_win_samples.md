
# 火山"视窗项目"例程集 

## vol-测试-测试-main

* **标签:** CV图像AI库, Curl网络传输, HPSocket网络通讯支持, MFC扩展界面支持类库1, MFC界面基本类, MFC表格组件, 仰望模块_VIP版, 测试
* **参考到:** [火山.MFC界面.基本.图片框](#火山.mfc界面.基本.图片框), [火山.MFC界面.基本.按钮](#火山.mfc界面.基本.按钮), [火山.MFC界面.基本.按钮基础类.被单击](#火山.mfc界面.基本.按钮基础类.被单击), [火山.MFC界面.基本.标签](#火山.mfc界面.基本.标签), [火山.MFC界面.基本.滑块条](#火山.mfc界面.基本.滑块条), [火山.MFC界面.基本.窗口](#火山.mfc界面.基本.窗口), [火山.MFC界面.基本.窗口.创建主窗口](#火山.mfc界面.基本.窗口.创建主窗口), [火山.MFC界面.基本.窗口.消息过滤](#火山.mfc界面.基本.窗口.消息过滤), [火山.MFC界面.基本.窗口组件.取窗口句柄](#火山.mfc界面.基本.窗口组件.取窗口句柄), [火山.MFC界面.基本.组件布局器.创建完毕](#火山.mfc界面.基本.组件布局器.创建完毕), [火山.MFC界面.基本.组件布局器.将被销毁](#火山.mfc界面.基本.组件布局器.将被销毁), [火山.MFC界面.基本.编辑框](#火山.mfc界面.基本.编辑框), [火山.MFC界面.基本.编辑框.内容](#火山.mfc界面.基本.编辑框.内容), [火山.MFC界面.基本.进度条](#火山.mfc界面.基本.进度条), [火山.MFC界面.基本.进度条.位置](#火山.mfc界面.基本.进度条.位置), [火山.仰望.BBAsio客户端类2_](#火山.仰望.bbasio客户端类2_), [火山.仰望.BBAsio客户端类2_.初始化](#火山.仰望.bbasio客户端类2_.初始化), [火山.仰望.BBAsio客户端类2_.访问](#火山.仰望.bbasio客户端类2_.访问), [火山.仰望.BBAsio客户端类2_.访问2](#火山.仰望.bbasio客户端类2_.访问2), [火山.仰望.BBAsio客户端类2_.释放客户端](#火山.仰望.bbasio客户端类2_.释放客户端), [火山.基本.字节集类](#火山.基本.字节集类), [火山.基本.对象类](#火山.基本.对象类), [火山.基本.数值范围](#火山.基本.数值范围), [火山.基本.数值范围.最小整数值](#火山.基本.数值范围.最小整数值), [火山.基本.整数类](#火山.基本.整数类), [火山.基本.整数类.值](#火山.基本.整数类.值), [火山.基本.文本类.到文本](#火山.基本.文本类.到文本), [火山.基本.磁盘操作类](#火山.基本.磁盘操作类), [火山.基本.磁盘操作类.读入文件](#火山.基本.磁盘操作类.读入文件), [火山.基本.程序调试类.调试输出](#火山.基本.程序调试类.调试输出), [火山.基本.窗口程序类](#火山.基本.窗口程序类), [火山.私有库.文本处理](#火山.私有库.文本处理), [火山.私有库.文本处理.文本_取随机文本](#火山.私有库.文本处理.文本_取随机文本), [火山.私有库.类_json](#火山.私有库.类_json), [火山.私有库.类_json.取通用属性](#火山.私有库.类_json.取通用属性), [火山.私有库.类_json.解析](#火山.私有库.类_json.解析)
* **源码:** 
	```volcano
	<火山程序 类型 = "通常" 版本 = 1 />

	包 火山.程序 <"">

	类 启动类 <公开 基础类 = 窗口程序类 注释 = "ref: 火山.MFC界面.基本.窗口.创建主窗口, 火山.基本.数值范围, 火山.基本.数值范围.最小整数值, 火山.基本.窗口程序类" 折叠
	        @视窗.使用静态运行时库 = 假>
	{
	    变量 主窗口对象 <类型 = 我的主窗口>

	    方法 启动方法 <公开 类型 = 整数 注释 = "ref: 火山.MFC界面.基本.窗口.创建主窗口, 火山.基本.数值范围, 火山.基本.数值范围.最小整数值" 折叠>
	    {
	        主窗口对象.创建主窗口 ()  // ref: 火山.MFC界面.基本.窗口.创建主窗口, 火山.基本.数值范围, 火山.基本.数值范围.最小整数值
	        返回 (1)
	    }
	}

	// ===

	类 我的主窗口 <基础类 = 窗口 注释 = "样例主窗口"
	        注释 = "ref: 火山.MFC界面.基本.图片框, 火山.MFC界面.基本.按钮, 火山.MFC界面.基本.按钮基础类.被单击, 火山.MFC界面.基本.标签, 火山.MFC界面.基本.滑块条, 火山.MFC界面.基本.窗口, 火山.MFC界面.基本.窗口.消息过滤, 火山.MFC界面.基本.窗口组件.取窗口句柄, 火山.MFC界面.基本.组件布局器.创建完毕, 火山.MFC界面.基本.组件布局器.将被销毁, 火山.MFC界面.基本.编辑框, 火山.MFC界面.基本.编辑框.内容, 火山.MFC界面.基本.进度条, 火山.MFC界面.基本.进度条.位置, 火山.仰望.BBAsio客户端类2_, 火山.仰望.BBAsio客户端类2_.初始化, 火山.仰望.BBAsio客户端类2_.访问, 火山.仰望.BBAsio客户端类2_.访问2, 火山.仰望.BBAsio客户端类2_.释放客户端, 火山.基本.字节集类, 火山.基本.整数类, 火山.基本.整数类.值, 火山.基本.文本类.到文本, 火山.基本.磁盘操作类, 火山.基本.磁盘操作类.读入文件, 火山.基本.程序调试类.调试输出, 火山.私有库.文本处理, 火山.私有库.文本处理.文本_取随机文本, 火山.私有库.类_json, 火山.私有库.类_json.取通用属性, 火山.私有库.类_json.解析"
	        折叠2 @视窗.布局 = "client_size = \"1202, 399\"" 标题 = "我的主窗口">
	{
	    变量 进度条1 <类型 = 进度条 注释 = "ref: 火山.MFC界面.基本.进度条" 折叠2 隐藏值属性 = "0"
	            @视窗.布局 = "id = 101\r\npos = \"445, 246, 232, 24\"" 标题 = "进度条1" 最小位置 = 0 最大位置 = 100>
	    变量 滑块条1 <类型 = 滑块条 注释 = "ref: 火山.MFC界面.基本.滑块条" 折叠2 隐藏值属性 = "0"
	            @视窗.布局 = "id = 102\r\npos = \"437, 334, 160, 32\"" 标题 = "滑块条1" 最小位置 = 0 最大位置 = 100>
	    变量 图片框1 <类型 = 图片框 注释 = "ref: 火山.MFC界面.基本.图片框" 折叠2 隐藏值属性 = "0"
	            @视窗.布局 = "id = 103\r\npos = \"725, 46, 200, 312\"" 标题 = "图片框1" 显示方式 = 缩放图片>
	    变量 编辑框_url <类型 = 编辑框 注释 = "ref: 火山.MFC界面.基本.编辑框" 折叠2 隐藏值属性 = "0"
	            @视窗.布局 = "id = 104\r\npos = \"69, 86, 368, 64\"" 是否允许多行 = 真>
	    变量 按钮1 <类型 = 按钮 注释 = "ref: 火山.MFC界面.基本.按钮" 折叠2 隐藏值属性 = "0"
	            @视窗.布局 = "id = 105\r\npos = \"45, 38, 48, 32\"" 标题 = "按钮1">
	    变量 按钮取空闲 <类型 = 按钮 注释 = "ref: 火山.MFC界面.基本.按钮" 折叠2 隐藏值属性 = "0"
	            @视窗.布局 = "id = 106\r\npos = \"181, 30, 48, 32\"" 标题 = "取空闲">
	    变量 按钮投递 <类型 = 按钮 注释 = "ref: 火山.MFC界面.基本.按钮" 折叠2 隐藏值属性 = "0"
	            @视窗.布局 = "id = 107\r\npos = \"117, 30, 48, 32\"" 标题 = "投递">
	    变量 编辑框1 <类型 = 编辑框 注释 = "ref: 火山.MFC界面.基本.编辑框" 折叠2 隐藏值属性 = "0"
	            @视窗.布局 = "id = 108\r\npos = \"61, 214, 368, 96\"" 是否允许多行 = 真>
	    变量 标签1 <类型 = 标签 注释 = "ref: 火山.MFC界面.基本.标签" 隐藏值属性 = "0" @视窗.布局 = "id = 109\r\npos = \"460, 30, 80, 32\"">
	    变量 bba <类型 = BBAsio客户端类2_ 注释 = "ref: 火山.仰望.BBAsio客户端类2_">
	    变量 文件复制器 <类型 = 文件复制类>

	    方法 按钮_被单击 <接收事件 类型 = 整数 注释 = "当按钮被单击后发送此事件"
	            注释 = "ref: 火山.MFC界面.基本.按钮, 火山.MFC界面.基本.按钮基础类.被单击, 火山.MFC界面.基本.窗口组件.取窗口句柄, 火山.MFC界面.基本.进度条, 火山.MFC界面.基本.进度条.位置, 火山.基本.程序调试类.调试输出">
	    参数 来源对象 <类型 = 按钮 注释 = "提供事件产生的具体来源对象" 注释 = "ref: 火山.MFC界面.基本.按钮">
	    参数 标记值 <类型 = 整数 注释 = "用户调用\"挂接事件\"命令时所提供的\"标记值\"参数值,非此方式挂接事件则本参数值固定为0.">
	    {
	        如果 (来源对象 == 按钮1)  // ref: 火山.MFC界面.基本.按钮
	        {
	            进度条1.位置 = 0  // ref: 火山.MFC界面.基本.进度条, 火山.MFC界面.基本.进度条.位置
	            调试输出 ("开始复制文件...")  // ref: 火山.基本.程序调试类.调试输出
	            文件复制器.执行复制 ("D:\\TP网络验证系统5.0.zip", "C:\\test_destination.zip", 取窗口句柄 ())  // ref: 火山.MFC界面.基本.窗口组件.取窗口句柄
	        }

	        返回 (0)
	    }

	    方法 车牌识别 <
	            注释 = "ref: 火山.MFC界面.基本.编辑框, 火山.MFC界面.基本.编辑框.内容, 火山.仰望.BBAsio客户端类2_, 火山.仰望.BBAsio客户端类2_.访问, 火山.仰望.BBAsio客户端类2_.访问2, 火山.基本.字节集类, 火山.基本.整数类, 火山.基本.整数类.值, 火山.基本.文本类.到文本, 火山.基本.磁盘操作类, 火山.基本.磁盘操作类.读入文件, 火山.基本.程序调试类.调试输出, 火山.私有库.文本处理, 火山.私有库.文本处理.文本_取随机文本, 火山.私有库.类_json, 火山.私有库.类_json.取通用属性, 火山.私有库.类_json.解析"
	            折叠>
	    参数 网址 <类型 = 文本型 @默认值 = "">
	    参数 图片路径 <类型 = 文本型 @默认值 = "">
	    {
	        变量 响应内容 <类型 = 文本型>
	        变量 图片数据 <类型 = 字节集类 注释 = "ref: 火山.基本.字节集类">
	        变量 multipart数据 <类型 = 字节集类 注释 = "ref: 火山.基本.字节集类">
	        变量 状态码 <类型 = 整数类 注释 = "ref: 火山.基本.整数类">
	        变量 错误信息 <类型 = 文本型>
	        变量 boundary <类型 = 文本型>
	        变量 multipart文本头 <类型 = 文本型>
	        变量 multipart文本尾 <类型 = 文本型>
	        如果 (网址 != "")
	        {

	            图片数据 = bba.访问 (网址, , , , , , , , , , , , , , , , )  // ref: 火山.仰望.BBAsio客户端类2_, 火山.仰望.BBAsio客户端类2_.访问, 火山.基本.字节集类
	        }
	        否则 (图片路径 != "")
	        {

	            图片数据 = 读入文件 (图片路径)  // ref: 火山.基本.字节集类, 火山.基本.磁盘操作类, 火山.基本.磁盘操作类.读入文件

	        }

	        boundary = "----WebKitFormBoundary" + 文本_取随机文本 (16)  // ref: 火山.私有库.文本处理, 火山.私有库.文本处理.文本_取随机文本

	        multipart文本头 = "--" + boundary + "\r\n"
	        multipart文本头 = multipart文本头 + "Content-Disposition: form-data; name=\"file\"; filename=\"image.jpg\"\r\n"
	        multipart文本头 = multipart文本头 + "Content-Type: image/jpeg\r\n\r\n"

	        multipart文本尾 = "\r\n--" + boundary + "--\r\n"

	        @ CVolMem memBuf1, memBuf2;
	        @ const char* header = GetMbsText(@<multipart文本头>.GetText(), memBuf1, NULL);
	        @ const char* tail = GetMbsText(@<multipart文本尾>.GetText(), memBuf2, NULL);
	        @ INT_P headerLen = strlen(header);
	        @ INT_P tailLen = strlen(tail);
	        @ INT_P imgSize = @<图片数据>.GetSize();
	        @ INT_P totalLen = headerLen + imgSize + tailLen;
	        @ @<multipart数据>.Alloc(totalLen);
	        @ BYTE* pData = (BYTE*)@<multipart数据>.GetPtr();
	        @ memcpy(pData, header, headerLen);
	        @ memcpy(pData + headerLen, @<图片数据>.GetPtr(), imgSize);
	        @ memcpy(pData + headerLen + imgSize, tail, tailLen);

	        响应内容 = bba.访问2 ("http://localhost:8000/recognize", 1, "", multipart数据, "Content-Type: multipart/form-data; boundary=" + boundary, , , 状态码, , , , 错误信息, , , 真, , , )  // ref: 火山.仰望.BBAsio客户端类2_, 火山.仰望.BBAsio客户端类2_.访问2, 火山.基本.字节集类, 火山.基本.整数类
	        变量 JSON <类型 = 类_json 注释 = "ref: 火山.私有库.类_json">
	        JSON.解析 (响应内容)  // ref: 火山.私有库.类_json, 火山.私有库.类_json.解析
	        编辑框1.内容 = JSON.取通用属性 ("results[0]['plate_no']")  // ref: 火山.MFC界面.基本.编辑框, 火山.MFC界面.基本.编辑框.内容, 火山.私有库.类_json, 火山.私有库.类_json.取通用属性
	        调试输出 ("状态码: " + 到文本 (状态码.值))  // ref: 火山.基本.整数类, 火山.基本.整数类.值, 火山.基本.文本类.到文本, 火山.基本.程序调试类.调试输出
	        调试输出 ("响应: " + 响应内容)  // ref: 火山.基本.程序调试类.调试输出
	        如果 (错误信息 != "")
	        {
	            调试输出 ("错误: " + 错误信息)  // ref: 火山.基本.程序调试类.调试输出
	        }



	    }

	    // 消息过滤方法 - 用于接收进度更新消息

	    方法 消息过滤 <公开 类型 = 逻辑型
	            注释 = "ref: 火山.MFC界面.基本.窗口, 火山.MFC界面.基本.窗口.消息过滤, 火山.MFC界面.基本.进度条, 火山.MFC界面.基本.进度条.位置, 火山.基本.文本类.到文本, 火山.基本.程序调试类.调试输出"
	            @虚拟方法 = 可覆盖>
	    参数 窗口句柄 <类型 = 变整数>
	    参数 消息值 <类型 = 整数>
	    参数 消息参数1 <类型 = 变整数>
	    参数 消息参数2 <类型 = 变整数>
	    参数 消息地址 <类型 = 变整数>
	    {
	        // 处理进度更新消息 (32769 = 0x8001)
	        如果 (消息值 == 32769)
	        {
	            进度条1.位置 = (整数)消息参数1  // ref: 火山.MFC界面.基本.进度条, 火山.MFC界面.基本.进度条.位置
	            调试输出 ("复制进度: " + 到文本 ((整数)消息参数1) + "%")  // ref: 火山.基本.文本类.到文本, 火山.基本.程序调试类.调试输出
	        }
	        返回 (父对象.消息过滤 (窗口句柄, 消息值, 消息参数1, 消息参数2, 消息地址))  // ref: 火山.MFC界面.基本.窗口, 火山.MFC界面.基本.窗口.消息过滤
	    }

	    // 接收文件复制完成事件

	    方法 文件复制类_复制完成 <接收事件 类型 = 整数 注释 = "ref: 火山.MFC界面.基本.进度条, 火山.MFC界面.基本.进度条.位置, 火山.基本.程序调试类.调试输出">
	    参数 来源对象 <类型 = 文件复制类>
	    参数 标记值 <类型 = 整数>
	    参数 是否成功 <类型 = 逻辑型>
	    {
	        如果 (是否成功)
	        {
	            进度条1.位置 = 100  // ref: 火山.MFC界面.基本.进度条, 火山.MFC界面.基本.进度条.位置
	            调试输出 ("文件复制完成!")  // ref: 火山.基本.程序调试类.调试输出
	        }
	        否则
	        {
	            调试输出 ("文件复制失败!")  // ref: 火山.基本.程序调试类.调试输出
	        }
	        返回 (0)
	    }

	    //

	    方法 我的主窗口_创建完毕 <接收事件 类型 = 整数 注释 = "当本组件及其中所有子组件均被创建完毕后发送此事件."
	            注释 = "ref: 火山.MFC界面.基本.组件布局器.创建完毕, 火山.仰望.BBAsio客户端类2_, 火山.仰望.BBAsio客户端类2_.初始化" 折叠>
	    参数 来源对象 <类型 = 我的主窗口 注释 = "提供事件产生的具体来源对象">
	    参数 标记值 <类型 = 整数 注释 = "用户调用\"挂接事件\"命令时所提供的\"标记值\"参数值,非此方式挂接事件则本参数值固定为0.">
	    {
	        bba.初始化 (, , , , , , )  // ref: 火山.仰望.BBAsio客户端类2_, 火山.仰望.BBAsio客户端类2_.初始化

	        返回 (0)
	    }

	    方法 我的主窗口_将被销毁 <接收事件 类型 = 整数 注释 = "当本组件被销毁前发送此事件"
	            注释 = "ref: 火山.MFC界面.基本.组件布局器.将被销毁, 火山.仰望.BBAsio客户端类2_, 火山.仰望.BBAsio客户端类2_.释放客户端" 折叠>
	    参数 来源对象 <类型 = 我的主窗口 注释 = "提供事件产生的具体来源对象">
	    参数 标记值 <类型 = 整数 注释 = "用户调用\"挂接事件\"命令时所提供的\"标记值\"参数值,非此方式挂接事件则本参数值固定为0.">
	    {
	        bba.释放客户端 ()  // ref: 火山.仰望.BBAsio客户端类2_, 火山.仰望.BBAsio客户端类2_.释放客户端

	        返回 (0)
	    }
	}

	// ===

	类 文件复制类 <注释 = "文件复制类，使用CopyFileExW实现带进度回调的文件复制" 注释 = "ref: 火山.基本.对象类">
	{
	    变量 复制进度 <静态 类型 = 整数 值 = 0>
	    变量 窗口句柄 <静态 类型 = 变整数>
	    变量 进度消息 <静态 类型 = 整数 值 = 32769>

	    // 复制完成事件

	    方法 复制完成 <公开 定义事件 类型 = 整数>
	    参数 是否成功 <类型 = 逻辑型>

	    // 静态回调函数 (供CopyFileExW使用)

	    方法 文件进度回调 <静态 类型 = 整数 @视窗.前缀文本 = "@CALLBACK">
	    参数 总文件尺寸 <类型 = 长整数>
	    参数 已传输 <类型 = 长整数>
	    参数 流尺寸 <类型 = 长整数>
	    参数 流已传输 <类型 = 长整数>
	    参数 流编号 <类型 = 整数>
	    参数 回调原因 <类型 = 整数>
	    参数 源文件句柄 <类型 = 变整数>
	    参数 目标文件句柄 <类型 = 变整数>
	    参数 用户数据 <类型 = 变整数>
	    {
	        @ if (@<总文件尺寸> > 0) {
	        @     int progress = (int)((@<已传输> * 100) / @<总文件尺寸>);
	        @     if (progress != @n<复制进度>) {
	        @         @n<复制进度> = progress;
	        @         // 通过PostMessage发送进度到窗口
	        @         if (@n<窗口句柄> != 0) {
	        @             ::PostMessageW((HWND)@n<窗口句柄>, @n<进度消息>, progress, 0);
	        @         }
	        @     }
	        @ }
	        @ return PROGRESS_CONTINUE;
	        返回 (0)
	    }

	    // 执行文件复制

	    方法 执行复制 <公开>
	    参数 源文件路径 <类型 = 文本型 @默认值 = "">
	    参数 目标文件路径 <类型 = 文本型 @默认值 = "">
	    参数 通知窗口句柄 <类型 = 变整数 @默认值 = 0>
	    {
	        变量 复制结果 <类型 = 逻辑型>

	        // 保存窗口句柄供回调使用
	        窗口句柄 = 通知窗口句柄
	        复制进度 = 0

	        // 使用CopyFileExW进行文件复制
	        @ BOOL success = ::CopyFileExW(
	        @     @<源文件路径>.GetText(),
	        @     @<目标文件路径>.GetText(),
	        @     (LPPROGRESS_ROUTINE)&@n<文件复制类.文件进度回调>,
	        @     NULL,
	        @     NULL,
	        @     0
	        @ );
	        @ @<复制结果> = success ? true : false;

	        // 触发复制完成事件
	        复制完成 (复制结果)
	    }

	    //
	}
	```
